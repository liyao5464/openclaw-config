# 2026-02-17 微信公众号发布排查记录

## 问题
尝试自动发布文章到微信公众号，始终失败。

## 排查过程

### 已尝试的方法

| 方法 | 结果 | 错误码 | 原因 |
|-----|------|-------|------|
| draft/add (无封面) | ❌ | 40007 | 必须提供 thumb_media_id |
| draft/add + 临时图片 | ❌ | 40007 | 不接受临时素材 media_id |
| draft/add + 永久图片 | ❌ | 40113 | 服务器无法生成有效JPEG |
| add_news (旧接口) | ❌ | 45106 | 接口已被微信弃用 |

### 发现

1. **旧接口已弃用**
   - `material/add_news` 接口已被微信官方弃用
   - 必须使用新的 `draft/add` 接口

2. **封面图要求**
   - draft/add 必须使用 **永久素材** 的 media_id
   - 临时素材的 media_id 不被接受
   - 封面图需要是有效的 JPEG 文件

3. **服务器限制**
   - 没有 PIL/Pillow 库
   - 没有 ImageMagick / ffmpeg
   - 无法下载外部图片（网络受限）
   - 手动构造的 JPEG 文件被微信识别为无效

### 结论

**无法在当前服务器环境自动发布**，原因：
1. 无法生成有效的封面图文件
2. 无法绕过封面图要求

### 解决方案

**方案1：手动发布** ✅ 立即可用
```
1. 打开 2026-chunwan-wechat-final.html
2. 复制内容到公众号后台
3. 手动上传封面图
4. 发布
```

**方案2：本地运行脚本** （需要 PIL 环境）
```bash
pip install pillow requests
python post_article.py
```

**方案3：使用 Chrome CDP 自动化**
- 绕过 API 限制
- 模拟浏览器操作
- 需要 Chrome 浏览器 + Playwright

## 记录时间
2026-02-17 16:22
